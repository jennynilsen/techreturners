<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.62.2" />
    <meta name="description" content="">


    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title> :: My New Hugo Site</title>

    
    <link href="/css/nucleus.css?1579521599" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1579521599" rel="stylesheet">
    <link href="/css/hybrid.css?1579521599" rel="stylesheet">
    <link href="/css/featherlight.min.css?1579521599" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1579521599" rel="stylesheet">
    <link href="/css/auto-complete.css?1579521599" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1579521599" rel="stylesheet">
    <link href="/css/theme.css?1579521599" rel="stylesheet">
    <link href="/css/hugo-theme.css?1579521599" rel="stylesheet">
    
      <link href="/css/theme-blue.css?1579521599" rel="stylesheet">
    

    <script src="/js/jquery-3.3.1.min.js?1579521599"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/04-services/01-expose-pod/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <p> Tech Returners </p>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1579521599"></script>
<script type="text/javascript" src="/js/auto-complete.js?1579521599"></script>
<script type="text/javascript">
    
        var baseurl = "http:\/\/example.org\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1579521599"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/01-introduction/" title="Introduction" class="dd-item 
        
        
        
        ">
      <a href="/01-introduction/">
          1. Introduction
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/01-introduction/04-nodes/" title="" class="dd-item 
        
        
        
        ">
      <a href="/01-introduction/04-nodes/">
          <b>- </b>Nodes
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/01-introduction/05-namespaces/" title="" class="dd-item 
        
        
        
        ">
      <a href="/01-introduction/05-namespaces/">
          <b>- </b>Namespaces
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/01-introduction/05-docker/" title="" class="dd-item 
        
        
        
        ">
      <a href="/01-introduction/05-docker/">
          <b>- </b>Docker
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/01-introduction/06-kubernetes/" title="" class="dd-item 
        
        
        
        ">
      <a href="/01-introduction/06-kubernetes/">
          <b>- </b>Kubernetes
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/02-pods/" title="Pods &amp; Nodes" class="dd-item 
        
        
        
        ">
      <a href="/02-pods/">
          2. Pods &amp; Nodes
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/02-pods/01-what-is-pod/" title="" class="dd-item 
        
        
        
        ">
      <a href="/02-pods/01-what-is-pod/">
          <b>- </b>Introduction
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/02-pods/02-create-pod/" title="" class="dd-item 
        
        
        
        ">
      <a href="/02-pods/02-create-pod/">
          <b>- </b>Create a Pod - Declarative
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/02-pods/03-create-pod/" title="" class="dd-item 
        
        
        
        ">
      <a href="/02-pods/03-create-pod/">
          <b>- </b>Create a Pod - Imperative
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/02-pods/06-self-healing-readiness/" title="" class="dd-item 
        
        
        
        ">
      <a href="/02-pods/06-self-healing-readiness/">
          <b>- </b>Self Healing - Readiness
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/02-pods/05-hands-on/" title="" class="dd-item ">
        <a href="/02-pods/05-hands-on/">
        <b>- </b>Hands on
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/02-pods/07-self-healing-liveness/" title="" class="dd-item 
        
        
        
        ">
      <a href="/02-pods/07-self-healing-liveness/">
          <b>- </b>Self Healing - Liveness
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/03-labels_and_annotations/" title="Labels &amp; Annotations" class="dd-item 
        
        
        
        ">
      <a href="/03-labels_and_annotations/">
          3. Labels &amp; Annotations
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/03-labels_and_annotations/01-labels/" title="" class="dd-item 
        
        
        
        ">
      <a href="/03-labels_and_annotations/01-labels/">
          <b>- </b>Labels
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/03-labels_and_annotations/02-annotations/" title="" class="dd-item 
        
        
        
        ">
      <a href="/03-labels_and_annotations/02-annotations/">
          <b>- </b>Annotations
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/04-services/" title="Services" class="dd-item 
        parent
        
        
        ">
      <a href="/04-services/">
          4. Services
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/04-services/01-expose-pod/" title="" class="dd-item 
        parent
        active
        
        ">
      <a href="/04-services/01-expose-pod/">
          <b>- </b>Expose Pod
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/04-services/02-nodeport/" title="" class="dd-item 
        
        
        
        ">
      <a href="/04-services/02-nodeport/">
          <b>- </b>NodePort
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/04-services/03-clusterip/" title="" class="dd-item 
        
        
        
        ">
      <a href="/04-services/03-clusterip/">
          <b>- </b>ClusterIP
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/04-services/04-loadbalancer/" title="" class="dd-item 
        
        
        
        ">
      <a href="/04-services/04-loadbalancer/">
          <b>- </b>LoadBalancer
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/04-services/05-endpoints/" title="" class="dd-item 
        
        
        
        ">
      <a href="/04-services/05-endpoints/">
          <b>- </b>Endpoints
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/05-cheat_sheet/" title="Deployments" class="dd-item 
        
        
        
        ">
      <a href="/05-cheat_sheet/">
          5. Cheat Sheet
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/05-cheat_sheet/01-deployment/" title="" class="dd-item 
        
        
        
        ">
      <a href="/05-cheat_sheet/01-deployment/">
          <b>- </b>Nginx Deployment
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/05-cheat_sheet/02-expose-deployment/" title="" class="dd-item 
        
        
        
        ">
      <a href="/05-cheat_sheet/02-expose-deployment/">
          <b>- </b>Expose Nginx Deployment
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/05-cheat_sheet/03-scaling/" title="" class="dd-item 
        
        
        
        ">
      <a href="/05-cheat_sheet/03-scaling/">
          <b>- </b>Scaling
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                  
                  
                  
                  <div id="top-github-link">
                    <a class="github-link" title='Edit this page' href="https://github.com/ansilh/k8s-training-doc/tree/master/content/04-Services/01-expose-pod/_index.md" target="blank">
                      <i class="fas fa-code-branch"></i>
                      <span id="top-github-link-text">Edit this page</span>
                    </a>
                  </div>
                  
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/'></a> > <a href='/04-services/'>Services</a> > 
          
         
          
         
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li></li>
      </ul>
    </li>
    <li><a href="#ports-in-service-objects">Ports in Service Objects</a>
      <ul>
        <li></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              
            </h1>
          

        




	<h1 id="expose-service-running-on-pod">Expose service running on Pod.</h1>
<h4 id="service">Service</h4>
<p>A Coffee Pod running in cluster and its listening on port 9090 on Pod's IP.
How can we expose that service to external world so that users can access it ?</p>
<p><img src="pod-service.png?classess=shadow" alt="Pod"></p>
<p>We need to <code>expose</code> the service.</p>
<p>As we know , the Pod IP is not routable outside of the cluster.
So we need a mechanism to reach the host's port and then that traffic should be diverted to Pod's port.</p>
<p>Lets create a Pod Yaml first.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ vi coffe.yaml
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: Pod
metadata:
  name: coffee
spec:
  containers:
  - image: ansilh/demo-coffee
    name: coffee
</code></pre></div><p>Create Yaml</p>
<pre><code>$ kubectl create -f coffe.yaml
</code></pre><p>Expose the Pod with below command</p>
<pre><code>$ kubectl expose pod coffee --port=80 --target-port=9090  --type=NodePort
</code></pre><p>This will create a <code>Service</code> object in kubernetes , which will map the Node's port 30836 to <code>Service</code> IP/Port 192.168.10.86:80</p>
<p>We can see the derails using <code>kubectl get service</code> command</p>
<pre><code>$ kubectl get service
NAME         TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)        AGE
coffee       NodePort    192.168.10.86    &lt;none&gt;        80:30391/TCP   6s
kubernetes   ClusterIP   192.168.10.1     &lt;none&gt;        443/TCP        26h
</code></pre><p>We can also see that the port is listening and kube-proxy is the one listening on that port.</p>
<pre><code>$ sudo netstat -tnlup |grep 30836
tcp6       0      0 :::30391                :::*                    LISTEN      2785/kube-proxy
</code></pre><p>Now you can open browser and access the <code>Coffee</code> app using URL <code>http://192.168.56.201:30391</code></p>
<h2 id="ports-in-service-objects">Ports in Service Objects</h2>
<h4 id="nodeport">nodePort</h4>
<p>This setting makes the service visible outside the Kubernetes cluster by the node’s IP address and the port number declared in this property. The service also has to be of type NodePort (if this field isn’t specified, Kubernetes will allocate a node port automatically).</p>
<h4 id="port">port</h4>
<p>Expose the service on the specified port internally within the cluster. That is, the service becomes visible on this port, and will send requests made to this port to the pods selected by the service.</p>
<h4 id="targetport">targetPort</h4>
<p>This is the port on the pod that the request gets sent to. Your application needs to be listening for network requests on this port for the service to work.</p>





<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/04-services/" title="Services"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/04-services/02-nodeport/" title="" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1579521599"></script>
    <script src="/js/perfect-scrollbar.min.js?1579521599"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1579521599"></script>
    <script src="/js/jquery.sticky.js?1579521599"></script>
    <script src="/js/featherlight.min.js?1579521599"></script>
    <script src="/js/highlight.pack.js?1579521599"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1579521599"></script>
    <script src="/js/learn.js?1579521599"></script>
    <script src="/js/hugo-learn.js?1579521599"></script>

    <link href="/mermaid/mermaid.css?1579521599" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1579521599"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>
